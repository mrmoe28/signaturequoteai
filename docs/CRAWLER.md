# Automated Product Crawler

## Overview

The SignatureQuoteCrawler includes an automated web crawler that scrapes product information from Signature Solar's website, including:

- Product names, SKUs, and prices
- Product images
- Detailed descriptions
- Technical specifications
- Features and benefits
- Dimensions, weight, warranty
- Certifications

## Automated Crawling Schedule

The crawler runs automatically **every day at 2:00 AM UTC** via Vercel Cron Jobs.

This keeps your product catalog synchronized with Signature Solar's latest:
- Prices
- Product availability
- New products
- Updated descriptions and specifications

## Manual Crawl Trigger

You can also trigger a crawl manually:

### Via API (requires authentication)

```bash
curl -X POST https://your-domain.vercel.app/api/crawl \
  -H "Authorization: Bearer YOUR_SECRET_TOKEN"
```

### Via Vercel Dashboard

1. Go to your Vercel project
2. Navigate to "Cron Jobs"
3. Find the `/api/crawl` job
4. Click "Run Now"

## Environment Variables Required

Add these to your Vercel project:

```bash
# Auto-generated by Vercel for cron authentication
VERCEL_CRON_SECRET=your-cron-secret

# Crawler configuration (optional)
CRAWLER_DELAY_MS=1000           # Delay between requests (respect rate limits)
CRAWLER_MAX_RETRIES=3           # Max retry attempts for failed requests
CRAWLER_TIMEOUT_MS=30000        # Request timeout in milliseconds
```

## Crawler Configuration

The crawler is configured to:

- **Respect robots.txt** - Automatically checks and follows robots.txt rules
- **Rate limiting** - 1 second delay between requests (configurable)
- **Retry logic** - Up to 3 retries for failed requests
- **Timeout handling** - 30 second timeout per page
- **Image processing** - Downloads and stores product images locally
- **Fallback search** - Uses Bing Image Search if product images not found

## Categories Crawled

The crawler automatically crawls these Signature Solar categories:

- Solar Panels
- Solar Batteries
- Solar Inverters
- Solar Charge Controllers
- Solar Accessories
- Solar Kits

## Monitoring Crawl Jobs

Crawl job status is tracked in the `crawl_jobs` database table with:

- Job ID
- Start/completion times
- Products processed count
- Products updated count
- Error messages (if any)

## Troubleshooting

### Crawler Not Running

1. Check Vercel Cron Job is enabled in dashboard
2. Verify `VERCEL_CRON_SECRET` environment variable is set
3. Check Vercel function logs for errors

### Missing Product Data

The crawler uses multiple extraction strategies:
1. JSON-LD structured data
2. Meta tags
3. DOM selectors
4. Cheerio parsing

If data is missing, the site structure may have changed. Check logs for extraction errors.

### Rate Limiting

If you're being rate-limited by Signature Solar:
1. Increase `CRAWLER_DELAY_MS` (default: 1000ms)
2. Reduce crawl frequency in vercel.json
3. Check robots.txt for crawl-delay directives

## Best Practices

- ✅ Run crawls during off-peak hours (currently 2 AM UTC)
- ✅ Monitor crawler logs regularly
- ✅ Respect website terms of service
- ✅ Keep delay between requests reasonable (>= 1 second)
- ✅ Set up error notifications for failed crawls

## Future Enhancements

Planned improvements:
- Incremental crawls (only update changed products)
- Webhook notifications on price changes
- Admin dashboard for crawler management
- Historical price tracking and alerts
